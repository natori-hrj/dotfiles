# Claude Code 設定ガイド

Claude Codeの動作をカスタマイズするための設定ファイル集です。

## 目次

- [概要](#概要)
- [セットアップ](#セットアップ)
- [ディレクトリ構造](#ディレクトリ構造)
- [設定ファイルの説明](#設定ファイルの説明)
- [使い方](#使い方)
- [カスタマイズ](#カスタマイズ)
- [ベストプラクティス](#ベストプラクティス)

## 概要

この設定により、Claude Codeは以下の機能を提供します：

- **一貫したコード品質**: コーディングスタイル、セキュリティ、テストの基準を自動適用
- **専門エージェント**: 設計、レビュー、TDDなど専門タスクへの委譲
- **スラッシュコマンド**: よく使うワークフローを簡単に実行
- **ルールベースの制約**: セキュリティやGitワークフローの自動チェック
- **スキル**: 言語別・領域別のベストプラクティスとパターン

## セットアップ

### 1. グローバル設定として使用する場合

```bash
# ~/.claude/ に配置
cp -r claude/* ~/.claude/
```

### 2. プロジェクト固有の設定として使用する場合

```bash
# プロジェクトルートに配置
cp -r claude/* /path/to/your/project/.claude/
```

### 3. dotfilesとしてシンボリックリンクで管理

```bash
ln -s ~/dotfiles/claude ~/.claude
```

## ディレクトリ構造

```
claude/
├── CLAUDE.md              # メイン設定ファイル
├── README.md              # このファイル
├── agents/                # 専門エージェント定義
│   ├── architect.md       # システム設計
│   ├── code-reviewer.md   # コードレビュー
│   ├── planner.md         # 実装計画
│   ├── security-reviewer.md # セキュリティ分析
│   └── tdd-guide.md       # テスト駆動開発
├── commands/              # スラッシュコマンド
│   ├── code-review.md     # /code-review
│   ├── plan.md            # /plan
│   └── tdd.md             # /tdd
├── rules/                 # 常に適用されるルール
│   ├── agents.md          # エージェント使用ルール
│   ├── coding-style.md    # コーディングスタイル
│   ├── git-workflow.md    # Gitワークフロー
│   ├── security.md        # セキュリティ要件
│   └── testing.md         # テスト要件
└── skills/                # ドメイン知識・パターン集
    ├── coding-standards.md  # 言語別コーディング標準
    ├── backend-patterns.md  # バックエンド開発パターン
    ├── frontend-patterns.md # フロントエンド開発パターン
    ├── database-patterns.md # データベース設計パターン
    └── api-design.md        # API設計パターン
```

## 設定ファイルの説明

### CLAUDE.md

プロジェクト全体の設定を記述するメインファイルです。Claude Codeが最初に読み込みます。

```markdown
# 含まれる内容
- プロジェクト概要
- 基本原則（品質、セキュリティ、テスト）
- エージェント使用ガイドライン
- コマンド一覧
```

### rules/（ルール）

**常に自動適用される**制約やガイドラインです。

| ファイル | 説明 | 主な内容 |
|---------|------|---------|
| `security.md` | セキュリティ要件 | OWASP対策、禁止事項、チェックリスト |
| `testing.md` | テスト要件 | カバレッジ目標、テストの種類、AAAパターン |
| `coding-style.md` | コーディングスタイル | 命名規則、イミュータビリティ、エラーハンドリング |
| `git-workflow.md` | Gitワークフロー | コミット規約、ブランチ戦略、PRテンプレート |
| `agents.md` | エージェント使用ルール | 委譲のタイミング、効率的な使い方 |

### agents/（エージェント）

特定のタスクに特化した専門エージェントです。

| エージェント | 用途 | 使用モデル |
|-------------|------|-----------|
| `planner` | 機能実装の詳細計画作成 | Sonnet |
| `architect` | システムアーキテクチャ設計 | Opus |
| `code-reviewer` | コード品質・セキュリティレビュー | Opus |
| `security-reviewer` | 脆弱性分析 | Opus |
| `tdd-guide` | テスト駆動開発のガイド | Sonnet |

### commands/（コマンド）

スラッシュで呼び出すショートカットコマンドです。

| コマンド | 説明 |
|---------|------|
| `/plan` | 機能の実装計画を作成 |
| `/code-review` | コードレビューを実行 |
| `/tdd` | TDDサイクルで実装 |

### skills/（スキル）

ドメイン知識やベストプラクティスを提供します。Claudeがコード生成時に参照します。

| スキル | 説明 | 主な内容 |
|--------|------|---------|
| `coding-standards.md` | 言語別コーディング標準 | TypeScript、Python、Goのベストプラクティス |
| `backend-patterns.md` | バックエンド開発パターン | アーキテクチャ、API設計、認証、キャッシュ |
| `frontend-patterns.md` | フロントエンド開発パターン | React、状態管理、パフォーマンス最適化 |
| `database-patterns.md` | データベース設計パターン | スキーマ設計、インデックス、ORM |
| `api-design.md` | API設計パターン | RESTful設計、認証、レート制限 |

## 使い方

### スラッシュコマンドの実行

```
# 実装計画を作成
/plan ユーザー認証機能を実装したい

# コードレビューを依頼
/code-review src/auth/login.ts

# TDDで実装
/tdd パスワードバリデーション関数を作成
```

### エージェントへの委譲

Claude Codeは必要に応じて自動的にエージェントに委譲しますが、
明示的に依頼することもできます。

```
# 設計を依頼
このAPIのアーキテクチャを設計して

# セキュリティレビューを依頼
この認証処理のセキュリティをレビューして

# 計画を依頼
この機能の実装計画を立てて
```

### ルールの自動適用

rules/内のファイルは自動的に適用されます。例えば：

```
# セキュリティルール違反を自動検出
APIキーをハードコードしようとすると警告

# Gitコミット時
規約に沿ったコミットメッセージを自動生成

# テスト作成時
AAAパターンに従ったテスト構造を提案
```

### スキルの活用

skills/内のパターンはコード生成時に自動的に参照されます。

```
# バックエンドAPI実装時
→ backend-patterns.md のエラーハンドリングパターンを適用

# Reactコンポーネント作成時
→ frontend-patterns.md のコンポーネント設計を参考に

# データベーススキーマ設計時
→ database-patterns.md の設計原則に従う
```

## カスタマイズ

### 新しいルールを追加

`rules/` に新しいMarkdownファイルを作成します。

```markdown
# rules/my-rule.md
---
name: my-rule
description: カスタムルールの説明
---

## ルール内容
- ルール1
- ルール2
```

### 新しいエージェントを追加

`agents/` に新しいMarkdownファイルを作成します。

```markdown
# agents/my-agent.md
---
name: my-agent
description: エージェントの説明
tools: Read, Grep, Glob
model: sonnet
---

あなたは[役割]です。

## 役割
[詳細な説明]

## 出力フォーマット
[期待する出力形式]
```

### 新しいコマンドを追加

`commands/` に新しいMarkdownファイルを作成します。

```markdown
# commands/my-command.md
---
name: my-command
description: コマンドの説明
---

[コマンド実行時の指示]
```

### 新しいスキルを追加

`skills/` に新しいMarkdownファイルを作成します。

```markdown
# skills/my-skill.md
---
name: my-skill
description: スキルの説明
---

## パターン1
[コード例と説明]

## パターン2
[コード例と説明]
```

### 設定のオーバーライド

プロジェクト固有の設定は、プロジェクトルートの `.claude/` に配置することで
グローバル設定をオーバーライドできます。

```
~/.claude/rules/security.md     # グローバル設定
./project/.claude/rules/security.md  # プロジェクト固有（優先）
```

## ベストプラクティス

### 1. コンテキスト管理

```
# 推奨
- 必要なファイルのみを参照
- 長いファイルは要約して渡す
- MCPサーバーは10個以下に制限

# 避ける
- 大量のファイルを一度に読み込む
- 不要なMCPサーバーの有効化
```

### 2. エージェントの効果的な活用

```
# 委譲すべきタスク
- 複雑な設計判断 → architect
- セキュリティ懸念 → security-reviewer
- 大規模な計画 → planner

# 直接対応すべきタスク
- 単純なバグ修正
- 小さな変更
- 設定値の変更
```

### 3. ルールの運用

```
# 効果的なルール
- 具体的で実行可能
- チェック可能な基準
- 例外ケースを明記

# 避けるべきルール
- 曖昧な表現
- 過度に厳格な制約
- 矛盾する指示
```

### 4. スキルの設計

```
# 効果的なスキル
- 具体的なコード例を含む
- Good/Bad の比較を示す
- 言語・フレームワーク固有のベストプラクティス

# 避けるべきスキル
- 抽象的すぎる説明
- 古い情報やパターン
- プロジェクト固有すぎる内容
```

### 5. コマンドの設計

```
# 良いコマンド
- 単一の明確な目的
- 再利用可能
- 出力形式が一貫

# 避けるべきコマンド
- 複数の責務を持つ
- 特定のプロジェクトに依存
```

## トラブルシューティング

### 設定が反映されない場合

1. ファイルパスを確認
2. YAMLフロントマターの構文を確認
3. Claude Codeを再起動

### エージェントが期待通り動作しない場合

1. `model` の指定を確認
2. `tools` の指定を確認
3. プロンプトの明確さを確認

### コマンドが見つからない場合

1. ファイル名と `name` フィールドの一致を確認
2. `commands/` ディレクトリに配置されているか確認

### スキルが参照されない場合

1. YAMLフロントマターの構文を確認
2. `skills/` ディレクトリに配置されているか確認
3. 関連するタスクを実行しているか確認

## 参考リンク

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/claude-code)
- [everything-claude-code](https://github.com/affaan-m/everything-claude-code) - 参考にした設定集
